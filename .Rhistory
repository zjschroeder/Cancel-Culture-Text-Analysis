#compute cosine similarity matrix
partisans_cosine <- textstat_simil(data_partisans_clean, margin = "documents", method = "cosine")
#igraph object
partisans_g <- graph_from_adjacency_matrix(as.matrix(partisans_cosine), mode = "undirected", weighted = TRUE, diag = FALSE)
partisans_g
partisans_g2 <- delete.edges(partisans_g, which(E(partisans_g)$weight <.2)) #remove low weights
View(partisans_g2)
rm(list = ls())
#load dataframe file
load("data_partisans_preprocess.RData")
#load TF-IDF file
load("replicationdata_partisans.RData")
#load TF-IDF file
load("data/replicationdata_partisans.RData")
#load TF-IDF file
load("politics_bio/replicationdata_partisans.RData")
View(data_partisans_clean)
head(docvars)
head(data_partisans_clean$docvars)
data_partisans_clean['Dimnames']$features
gc()
#load TF-IDF file
load("politics_bio/replicationdata_partisans.RData")
View(data_partisans_clean)
data_partisans_clean@Dimnames
data_partisans_clean@x
library(quanteda.textstats)
library(igraph)
library(dplyr)
#load TF-IDF file
load("politics_bio/replicationdata_partisans.RData")
#compute cosine similarity matrix
partisans_cosine <- textstat_simil(data_partisans_clean, margin = "documents", method = "cosine")
#igraph object
partisans_g <- graph_from_adjacency_matrix(as.matrix(partisans_cosine), mode = "undirected", weighted = TRUE, diag = FALSE)
partisans_g2 <- delete.edges(partisans_g, which(E(partisans_g)$weight <.2)) #remove low weights
E(partisans_g2)$weight <- 1 #binarize data
Isolated <- which(degree(partisans_g2)==0) #identify isolated nodes
partisans_g3 <- delete.vertices(partisans_g2, Isolated) #remove isolated nodes
#add partisan node attributes
df <- igraph::as_data_frame(partisans_g3, 'both')
View(df)
View(data_partisans_clean)
data_partisans <- data_partisans_clean@docvars
View(data_partisans)
df$vertices <- df$vertices %>%
left_join(data_partisans, c('name'='Id'))
partisans_g4 <- graph_from_data_frame(df$edges,
directed = F,
vertices = df$vertices)
table(V(partisans_g4)$party)
#calculate partisan modularity
modularity(partisans_g4, factor(V(partisans_g4)$party))
###############################################################################################
#REPLICATION DATA: The data and code for this section are available for study replication.
###############################################################################################
load("replicationdata_scatterplot.RData")
###############################################################################################
#REPLICATION DATA: The data and code for this section are available for study replication.
###############################################################################################
load("politics_bio/replicationdata_scatterplot.RData")
#For plot
mid <- mean(data_scatter$partisanlean)
#scatterplot
LIBandCONSERV <- ggplot(data_scatter, aes(x = libcos , y = concos, label = rownames(feature1))) +
geom_abline(intercept = 0, slope = 1) +
geom_label_repel(size =6, aes(color = partisanlean, label=feature1, hjust=0, vjust=0), data=data_scatter, max.overlaps = getOption("ggrepel.max.overlaps", default = 100), segment.size = 0, label.padding = .3, box.padding = .3, point.padding = .5, force = 2) +
scale_color_gradient2(midpoint = mid, low = "navyblue", mid = "grey50", high = "darkred", space = "Lab" )
library(ggplot)
library(tidyverse)
library(quanteda.textstats)
library(igraph)
library(quanteda)
library(tidyverse)
library(quanteda.textstats)
library(igraph)
library(ggplot2)
library(ggrepel)
#scatterplot
LIBandCONSERV <- ggplot(data_scatter, aes(x = libcos , y = concos, label = rownames(feature1))) +
geom_abline(intercept = 0, slope = 1) +
geom_label_repel(size =6, aes(color = partisanlean, label=feature1, hjust=0, vjust=0), data=data_scatter, max.overlaps = getOption("ggrepel.max.overlaps", default = 100), segment.size = 0, label.padding = .3, box.padding = .3, point.padding = .5, force = 2) +
scale_color_gradient2(midpoint = mid, low = "navyblue", mid = "grey50", high = "darkred", space = "Lab" )
#change background color
test <- LIBandCONSERV + theme(legend.position = "none",
panel.background = element_rect(fill = "white",colour = "white", size = 0.5, linetype = "solid"),
panel.grid.major = element_line(size = 0.5, linetype = 'solid',colour = "gray90"),
panel.grid.minor = element_line(size = 0.25, linetype = 'solid', colour = "gray90"),
axis.title.x = element_text(size = 20), axis.title.y = element_text(size = 20),plot.title = element_text(size = 25),
axis.text.x = element_text(size=14),
axis.text.y = element_text(size=14)) +
scale_x_continuous(limits = c(-.06, .2), n.breaks = 6) +
scale_y_continuous(limits = c(-.06, .28), n.breaks = 6) +
xlab("Liberal Cosine Value") + ylab("Conservative Cosine Value")
#change background color
test <- LIBandCONSERV + theme(legend.position = "none",
panel.background = element_rect(fill = "white",colour = "white", linewidth = 0.5, linetype = "solid"),
panel.grid.major = element_line(linewidth = 0.5, linetype = 'solid',colour = "gray90"),
panel.grid.minor = element_line(linewidth = 0.25, linetype = 'solid', colour = "gray90"),
axis.title.x = element_text(size = 20), axis.title.y = element_text(size = 20),plot.title = element_text(size = 25),
axis.text.x = element_text(size=14),
axis.text.y = element_text(size=14)) +
scale_x_continuous(limits = c(-.06, .2), n.breaks = 6) +
scale_y_continuous(limits = c(-.06, .28), n.breaks = 6) +
xlab("Liberal Cosine Value") + ylab("Conservative Cosine Value")
test
View(data_partisans_clean)
View(data_partisans)
essig_dellaposta <- c(
"left",
"democrat",
'resist',
'liber',
'obama',
'feelthebern',
'swj',
'nastywoman',
'imwithh',
'fbr',
'bluewav',
'uniteblu',
'neveragain',
'clinton',
'communist',
'voteblu',
'neverthelessshepersisted',
'berniesand',
'biden',
'notmypresid',
'marxist',
'demforc',
'gop',
'berniecrat',
'exgop',
'votehillari',
'conserv',
'libertarian',
'rightwing',
'keepamericagreat',
'tcot',
'maga',
'deplor',
'altright',
'teaparty',
'buildthewal',
'ccot',
'marcorubio',
'americafirst',
'draintheswamp',
'raisedright',
'tedcruz',
'jebbush',
'votered',
'redwave'
)
#load data
load("replicationdata_heatmap.RData")
#load data
load("politics_bio/replicationdata_heatmap.RData")
rm(list = ls())
library(pheatmap)
library(RColorBrewer)
library(viridis)
#load data
load("politics_bio/replicationdata_heatmap.RData")
View(heat_TFIDF)
#cosine Similarity matrix
test_cosine <- textstat_simil(heat_TFIDF, margin = "features", method = "cosine") #correlation
test_corr <- textstat_simil(heat_TFIDF, margin = "features", method = "correlation") #cosine
cos_mat <- as.matrix(test_cosine)
corr_mat <- as.matrix(test_corr)
corr_mat
quantile_breaks <- function(xs, n = 10) {
breaks <- quantile(xs, probs = seq(0, 1, length.out = n))
breaks[!duplicated(breaks)]
}
mat_breaks <- quantile_breaks(corr_mat)
mat_breaks
corrmap_quant <- pheatmap(
mat               = corr_mat,
color             = turbo(length(mat_breaks) - 1),
breaks            = mat_breaks,
border_color      = NA,
show_colnames     = TRUE,
show_rownames     = TRUE,
drop_levels       = TRUE,
cluster_rows      = FALSE,
cluster_cols      = FALSE,
fontsize          = 14,
main              = "Quantile Correlation Values"
)
mat_breaks <- quantile_breaks(cos_mat)
cosmap_quant <- pheatmap(
mat               = cos_mat,
color             = turbo(length(mat_breaks) - 1),
breaks            = mat_breaks,
border_color      = NA,
show_colnames     = TRUE,
show_rownames     = TRUE,
drop_levels       = TRUE,
cluster_rows      = FALSE,
cluster_cols      = FALSE,
fontsize          = 14,
main              = "Quantile - Cosine Values"
)
corrmap_quant
cos_mat <- as.matrix(test_cosine)
cos_mat
View(corr_mat)
x <- names(cos_mat)
cos_mat <- as.matrix(test_cosine) %>% as.tibble()
cos_mat <- as.matrix(test_cosine) %>% as_tibble()
cos_mat
x <- names(cosmat)
x <- names(cos_mat)
essig_dellaposta <- x
x
essig_dellaposta <- c(
"altright","berniecrat",
"americafirst","bernie",
"buildthewall","joebiden",
"ccot","bluewave",
"conserv","hillary",
"deplorable","communist",
"drainttheswamp","dem",
"gop","demforce",
"jebbush","democrat",
"keepamericagreat","exgop",
"libertarian","fightbackresistance",
"makeamericagreatagain", "feelthebern",
"marcorrubio","imwithher",
"neverhillary","left",
"pence","liber",
"raised right","marxist",
"redwave","nastywoman",
"republican","neveragain",
"rightwing","neverthelessshepersisted",
"reagan","notmypresident",
"tcot","obama",
"teaparty","progress",
"tedcruz","resist",
"donaldtrump","sjw",
"votered","takeaction",
"uniteblue","votebernie",
"voteblue","votehillary",
"bush","biden",
"rubio","sanders",
"trump", "berniesanders",
"hillaryclinton")
length(essig_dellaposta)
rep(c(1, -1), 30)
essig_dellaposta$partisan <- c(rep(c(1, -1), 30), 1)
c(rep(c(1, -1), 30), 1)
essig_dellaposta <- c(
"altright","berniecrat",
"americafirst","bernie",
"buildthewall","joebiden",
"ccot","bluewave",
"conserv","hillary",
"deplorable","communist",
"drainttheswamp","dem",
"gop","demforce",
"jebbush","democrat",
"keepamericagreat","exgop",
"libertarian","fightbackresistance",
"makeamericagreatagain", "feelthebern",
"marcorrubio","imwithher",
"neverhillary","left",
"pence","liber",
"raised right","marxist",
"redwave","nastywoman",
"republican","neveragain",
"rightwing","neverthelessshepersisted",
"reagan","notmypresident",
"tcot","obama",
"teaparty","progress",
"tedcruz","resist",
"donaldtrump","sjw",
"votered","takeaction",
"uniteblue","votebernie",
"voteblue","votehillary",
"bush","biden",
"rubio","sanders",
"trump", "berniesanders",
"hillaryclinton")
terms <- c(
"altright","berniecrat",
"americafirst","bernie",
"buildthewall","joebiden",
"ccot","bluewave",
"conserv","hillary",
"deplorable","communist",
"drainttheswamp","dem",
"gop","demforce",
"jebbush","democrat",
"keepamericagreat","exgop",
"libertarian","fightbackresistance",
"makeamericagreatagain", "feelthebern",
"marcorrubio","imwithher",
"neverhillary","left",
"pence","liber",
"raised right","marxist",
"redwave","nastywoman",
"republican","neveragain",
"rightwing","neverthelessshepersisted",
"reagan","notmypresident",
"tcot","obama",
"teaparty","progress",
"tedcruz","resist",
"donaldtrump","sjw",
"votered","takeaction",
"uniteblue","votebernie",
"voteblue","votehillary",
"bush","biden",
"rubio","sanders",
"trump", "berniesanders",
"hillaryclinton")
partisan <- c(rep(c(1, -1), 30), 1)
essig_dellaposta <- tibble(terms, partisan
)
partisan
View(essig_dellaposta)
partisan <- c(rep(c(0, 1), 30), 1)
essig_dellaposta <- tibble(terms, partisan
)
View(essig_dellaposta)
partisan <- c(rep(c("conserv", "lib"), 27), rep("lib",5))
partisan <- c(rep(c("conserv", "lib"), 28), rep("lib",5))
essig_dellaposta <- tibble(terms, partisan
)
terms <- c(
"altright","berniecrat",
"americafirst","bernie",
"buildthewall","joebiden",
"ccot","bluewave",
"conserv","hillary",
"deplorable","communist",
"drainttheswamp","dem",
"gop","demforce",
"jebbush","democrat",
"keepamericagreat","exgop",
"libertarian","fightbackresistance",
"makeamericagreatagain", "feelthebern",
"marcorrubio","imwithher",
"neverhillary","left",
"pence","liber",
"raised right","marxist",
"redwave","nastywoman",
"republican","neveragain",
"rightwing","neverthelessshepersisted",
"reagan","notmypresident",
"tcot","obama",
"teaparty","progress",
"tedcruz","resist",
"donaldtrump","sjw",
"votered","takeaction",
"bush","biden",
"rubio","sanders",
"trump", "berniesanders",
"hillaryclinton","uniteblue","votebernie","voteblue","votehillary",)
terms <- c(
"altright","berniecrat",
"americafirst","bernie",
"buildthewall","joebiden",
"ccot","bluewave",
"conserv","hillary",
"deplorable","communist",
"drainttheswamp","dem",
"gop","demforce",
"jebbush","democrat",
"keepamericagreat","exgop",
"libertarian","fightbackresistance",
"makeamericagreatagain", "feelthebern",
"marcorrubio","imwithher",
"neverhillary","left",
"pence","liber",
"raised right","marxist",
"redwave","nastywoman",
"republican","neveragain",
"rightwing","neverthelessshepersisted",
"reagan","notmypresident",
"tcot","obama",
"teaparty","progress",
"tedcruz","resist",
"donaldtrump","sjw",
"votered","takeaction",
"bush","biden",
"rubio","sanders",
"trump", "berniesanders",
"hillaryclinton","uniteblue","votebernie","voteblue","votehillary",)
terms <- c(
"altright","berniecrat",
"americafirst","bernie",
"buildthewall","joebiden",
"ccot","bluewave",
"conserv","hillary",
"deplorable","communist",
"drainttheswamp","dem",
"gop","demforce",
"jebbush","democrat",
"keepamericagreat","exgop",
"libertarian","fightbackresistance",
"makeamericagreatagain", "feelthebern",
"marcorrubio","imwithher",
"neverhillary","left",
"pence","liber",
"raised right","marxist",
"redwave","nastywoman",
"republican","neveragain",
"rightwing","neverthelessshepersisted",
"reagan","notmypresident",
"tcot","obama",
"teaparty","progress",
"tedcruz","resist",
"donaldtrump","sjw",
"votered","takeaction",
"bush","biden",
"rubio","sanders",
"trump", "berniesanders",
"hillaryclinton","uniteblue","votebernie","voteblue","votehillary")
partisan <- c(rep(c("conserv", "lib"), 28), rep("lib",5))
essig_dellaposta <- tibble(terms, partisan
)
View(essig_dellaposta)
partisan <- c(rep(c("conserv", "lib"), 28), rep("lib",5)) %>% factor()
essig_dellaposta <- tibble(terms,
partisan,
party = as.numeric(partisan)
)
essig_dellaposta <- tibble(terms,
partisan,
p = as.numeric(partisan)
)
rm(list = ls())
library(quanteda)
library(tidyverse)
library(quanteda.textstats)
library(igraph)
library(ggplot2)
library(ggrepel)
twitterdata = read.csv(here::here("data/study1.csv"), nrows = 1000) %>%
mutate(
posttoken = gsub("[[:punct:]]", "", posttoken)
)
terms_corp <- corpus(twitterdata, text_field = "posttoken") %>% tokens()
terms_Dfm <- dfm(terms_corp, verbose = FALSE)
terms_Dfm2<- dfm_trim(terms_Dfm, min_docfreq = 0.001, docfreq_type = "prop")
terms_Dfm3 <- dfm_subset(terms_Dfm2, ntoken(terms_Dfm2) > 0)
data_terms_clean <- dfm_tfidf(terms_Dfm3)
terms_cosine <- textstat_simil(data_terms_clean, margin = "features", method = "cosine")
terms_g <- graph_from_adjacency_matrix(as.matrix(terms_cosine), mode = "undirected", weighted = TRUE, diag = FALSE)
terms <- c(
"altright","berniecrat",
"americafirst","bernie",
"buildthewall","joebiden",
"ccot","bluewave",
"conserv","hillary",
"deplorable","communist",
"drainttheswamp","dem",
"gop","demforce",
"jebbush","democrat",
"keepamericagreat","exgop",
"libertarian","fightbackresistance",
"makeamericagreatagain", "feelthebern",
"marcorrubio","imwithher",
"neverhillary","left",
"pence","liber",
"raised right","marxist",
"redwave","nastywoman",
"republican","neveragain",
"rightwing","neverthelessshepersisted",
"reagan","notmypresident",
"tcot","obama",
"teaparty","progress",
"tedcruz","resist",
"donaldtrump","sjw",
"votered","takeaction",
"bush","biden",
"rubio","sanders",
"trump", "berniesanders",
"hillaryclinton","uniteblue","votebernie","voteblue","votehillary")
partisan <- c(rep(c("conserv", "lib"), 28), rep("lib",5)) %>% factor()
essig_dellaposta <- tibble(terms,
partisan,
p = as.numeric(partisan)
)
write.csv(essig_dellaposta, "data/partisan_terms.csv")
partisan_terms <- rio::import('data/partisan_terms.csv')
View(partisan_terms)
rm(list = ls())
partisan_terms <- rio::import('data/partisan_terms.csv')
twitterdata = read.csv(here::here("data/study1.csv"), nrows = 1000) %>%
mutate(
posttoken = gsub("[[:punct:]]", "", posttoken)
)
terms_corp <- corpus(twitterdata,
text_field = "posttoken") %>%
tokens()
terms_Dfm <- dfm(terms_corp, verbose = FALSE)
View(terms_corp)
View(terms_Dfm)
terms_Dfm@docvars
terms_corp <- corpus(twitterdata,
text_field = "posttoken") %>%
tokens()
View(terms_corp)
terms_Dfm <- dfm(terms_corp, verbose = FALSE)
View(terms_Dfm)
matrix(terms_Dfm)
x <- matrix(terms_Dfm)
View(x)
x <- tibble(terms_Dfm)
